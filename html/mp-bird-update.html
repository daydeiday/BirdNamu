<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마이페이지: 반려조 정보 수정</title>
    <link rel="stylesheet" href="../data/style/mp-bird-update.css" type="text/css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="../js/mp-bird-update.js"></script>
</head>

<body>
<header>
    <button onclick="history.back()">뒤로가기</button>
    <h1>반려조 정보 수정하기</h1>
</header>

<main>
    <section class="title">
        <div>반려조를 선택해주세요.</div>
    </section>
    <section class="form">
        <article>
            <label for="selectBird">반려조 선택하기:</label>
            <select id="selectBird" name="selectBird">
                <option value="송송이">송송이</option>
                <option value="솜솜이">솜솜이</option>
                <option value="다솜이">다솜이</option>
            </select>
        </article>
        <div id="birdInfo" style="display: none;">
            <section class="title">
                <div>반려조 정보를 수정해주세요.</div>
            </section>
            <section class="form">
                <form id="birdForm">
                    <article>
                        <label for="birdImage">이미지 재업로드:</label>
                        <input type="file" id="birdImage" name="birdImage" accept="image/*">
                    </article>
                    <article>
                        <label for="username">이름:</label>
                        <input type="text" id="username" name="username">
                    </article>
                    <article>
                        <label for="species">종:</label>
                        <select id="species" name="species"></select>
                    </article>
                    <article>
                        <label for="birthdate">생년월일:</label>
                        <input type="date" id="birthdate" name="birthdate">
                        <span id="ageInMonths"></span>
                    </article>
                    <article>
                        <label for="gender">성별:</label>
                        <select name="gender" id="gender">
                            <option value="female">수컷</option>
                            <option value="male">암컷</option>
                            <option value="other">모름</option>
                        </select>
                    </article>
                    <article>
                        <label for="traits">성격:</label>
                        <div id="selected-traits"></div>
                        <select id="traits" name="traits" multiple></select>
                    </article>
                </form>
            </section>
            <section class="submit">
                <article>
                    <input type="button" id="submit" value="수정 완료" onclick="handleSubmit()">
                </article>
                <article>
                    <input type="button" id="delete" value="반려조 삭제하기" onclick="handleDelete()">
                </article>
            </section>
        </div>
    </section>
</main>

<footer class="navbar">
    <ul>
        <li><a href="../html/main-board.html"><img src="../data/img/icons/compass-solid-color.svg"/></a></li>                
        <li><a href="../html/main-todo.html"><img src="../data/img/icons/list-check-solid.svg"/></a></li>
        <li><a href="../html/main.html"><img src="../data/img/icons/pen-nib-solid.svg"/></a></li>
        <li><a href="../html/checker_info.html"><img src="../data/img/icons/stethoscope-solid.svg"/></a></li>
        <li><a href="../html/login.html"><img src="../data/img/icons/circle-user-solid.svg"/></a></li>
    </ul>
</footer>

<script>
    $(document).ready(function() {
        // 종 정보 로드
        $.getJSON('../data/species.json', function(data) {
            let speciesOptions = '';
            data.forEach(function(species) {
                speciesOptions += `<option value="${species.value}">${species.text}</option>`;
            });
            $('#species').html(speciesOptions);
        });

        // 성격 정보 로드
        $.getJSON('../data/traits.json', function(data) {
            let traitsOptions = '';
            data.forEach(function(trait) {
                traitsOptions += `<option value="${trait.value}">${trait.text}</option>`;
            });
            $('#traits').html(traitsOptions);
        });

        // 생년월일 선택 시 개월 수 계산
        $('#birthdate').on('change', function() {
            const birthDate = new Date(this.value);
            const today = new Date();
            const ageInMonths = (today.getFullYear() - birthDate.getFullYear()) * 12 + (today.getMonth() - birthDate.getMonth());
            $('#ageInMonths').text(`(${ageInMonths}개월)`);
        });

        // 성격 선택 처리
        $('#traits').on('change', function() {
            const selectedOptions = Array.from(this.selectedOptions).map(option => option.text);
            const selectedTraitsHtml = selectedOptions.map(trait => `<span class="selected-trait">${trait}</span>`).join('');
            $('#selected-traits').html(selectedTraitsHtml);
        });

        // 반려조 선택 시 정보 표시
        $('#selectBird').on('change', function() {
            const selectedBird = this.value;
            $('#birdInfo').show();
            // 여기에서 선택한 반려조의 정보를 로드해서 표시하는 로직 추가
            // 예시로 송송이의 정보를 채워서 표시합니다.
            if (selectedBird === '송송이') {
                $('#username').val('송송이');
                $('#birthdate').val('2020-01-01');
                $('#gender').val('female');
                $('#species').val('budgerigar');
                $('#traits').val(['curious', 'active']);
                $('#selected-traits').html('<span class="selected-trait">호기심많은</span><span class="selected-trait">활발한</span>');
            }
            // 다른 반려조의 정보도 비슷하게 처리합니다.
        });
    });

    function handleSubmit() {
        const form = document.getElementById('birdForm');
        const formData = new FormData(form);

        const name = formData.get('username');
        const birthdate = formData.get('birthdate');
        const gender = formData.get('gender');
        const species = formData.get('species');
        const traits = formData.getAll('traits');

        // 생년월일로부터 개월 수 계산
        const birthDateObj = new Date(birthdate);
        const today = new Date();
        const ageInMonths = (today.getFullYear() - birthDateObj.getFullYear()) * 12 + (today.getMonth() - birthDateObj.getMonth());

        // 성격 선택 제한 확인
        if (traits.length < 1 || traits.length > 3) {
            alert('성격은 1개 이상 3개 이하로 선택해주세요.');
            return;
        }

        const body = document.querySelector('body');
        body.innerHTML =
            '<main class="submitted"><section><div id="logo">새와나(id="logo")</div><div id="submitted"><h1>반갑습니다 :D</h1><h2>정보 수정이 완료되었습니다.</h2><div><a href="./login.html">로그인하러 가기</a></div></div></section></main>';
    }

    function handleDelete() {
        if (confirm('반려조를 정말 삭제하겠습니까?')) {
            // 삭제 처리 로직 추가
            alert('반려조가 삭제되었습니다.');
            // 삭제 후 페이지를 새로 고침하거나 다른 처리를 할 수 있습니다.
        }
    }
</script>
</body>
</html>
